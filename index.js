!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=22)}([function(e,t){e.exports=require("tslib")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Mw=void 0;var n=function(){function e(e){var t=this;this.ws=e,this.name="Mw",this.sendMessage=function(e){t.ws.readyState===t.ws.OPEN&&t.ws.send(JSON.stringify(e))},this.ws.addEventListener("message",this.onSocketMessage.bind(this)),this.ws.addEventListener("close",this.onSocketClose.bind(this))}return e.processChannel=function(e,t,r){},e.processRequest=function(e,t){},e.prototype.onSocketClose=function(){this.release()},e.prototype.release=function(){var e=this.ws,t=e.readyState,r=e.CLOSED,n=e.CLOSING;t!==r&&t!==n&&this.ws.close()},e}();t.Mw=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ACTION=void 0,function(e){e.LIST_HOSTS="list-hosts",e.APPL_DEVICE_LIST="appl-device-list",e.GOOG_DEVICE_LIST="goog-device-list",e.MULTIPLEX="multiplex",e.SHELL="shell",e.PROXY_WS="proxy-ws",e.PROXY_ADB="proxy-adb",e.DEVTOOLS="devtools",e.STREAM_SCRCPY="stream",e.STREAM_WS_QVH="stream-qvh",e.STREAM_MJPEG="stream-mjpeg",e.PROXY_WDA="proxy-wda",e.FILE_LISTING="list-files"}(t.ACTION||(t.ACTION={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.filterTrailingZeroes=function(e){var t=0;return e.reverse().filter((function(e){return t||(t=e)})).reverse()},e.prettyBytes=function(t){for(var r=0;t>=512;)r++,t/=1024;return""+t.toFixed(r?1:0)+e.SUFFIX[r]},e.escapeUdid=function(e){return"udid_"+e.replace(/[. :]/g,"_")},e.parseBooleanEnv=function(e){return"boolean"==typeof e?e:void 0!==e?(Array.isArray(e)&&(e=e[e.length-1]),"1"===e||"true"===e.toLowerCase()):void 0},e.parseStringEnv=function(e){return void 0===e?"":(Array.isArray(e)&&(e=e[e.length-1]),e)},e.parseIntEnv=function(e){if("number"==typeof e)return e;if(void 0!==e){Array.isArray(e)&&(e=e[e.length-1]);var t=parseInt(e,10);if(!isNaN(t))return t}},e.utf8ByteArrayToString=function(e){for(var t=[],r=0,n=0;r<e.length;){var i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){var o=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=e[r++]))<<12|(63&(a=e[r++]))<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{o=e[r++];var a=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return t.join("")},e.supportsPassive=function(){if("boolean"==typeof e.supportsPassiveValue)return e.supportsPassiveValue;var t=!1;try{var r=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassive",null,r),window.removeEventListener("testPassive",null,r)}catch(e){}return e.supportsPassiveValue=t},e.SUFFIX={0:"B",1:"KiB",2:"MiB",3:"GiB",4:"TiB"},e.stringToUtf8ByteArray=function(e){for(var t=[],r=0,n=0;n<e.length;n++){var i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296==(64512&i)&&n+1<e.length&&56320==(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128)}return Uint8Array.from(t)},e}();t.default=n},function(e,t){e.exports=require("path")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypedEmitter=void 0;var n=r(32),i=function(){function e(){this.emitter=new n.EventEmitter}return e.prototype.addEventListener=function(e,t){this.emitter.on(e,t)},e.prototype.removeEventListener=function(e,t){this.emitter.off(e,t)},e.prototype.dispatchEvent=function(e){return this.emitter.emit(e.type,e)},e.prototype.on=function(e,t){this.emitter.on(e,t)},e.prototype.once=function(e,t){this.emitter.once(e,t)},e.prototype.off=function(e,t){this.emitter.off(e,t)},e.prototype.emit=function(e,t){return this.emitter.emit(e,t)},e}();t.TypedEmitter=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChannelCode=void 0,function(e){e.FSLS="FSLS",e.HSTS="HSTS",e.SHEL="SHEL",e.GTRC="GTRC",e.ATRC="ATRC",e.WDAP="WDAP",e.QVHS="QVHS"}(t.ChannelCode||(t.ChannelCode={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventClass=t.Event2=void 0;var n=r(0),i=function(){function e(e,t){void 0===t&&(t={cancelable:!0,bubbles:!0,composed:!1}),this.isTrusted=!0,this.AT_TARGET=0,this.BUBBLING_PHASE=0,this.CAPTURING_PHASE=0,this.NONE=0;var r=n.__assign({},t),i=r.cancelable,o=r.bubbles,s=r.composed;this.cancelable=!!i,this.bubbles=!!o,this.composed=!!s,this.type=""+e,this.defaultPrevented=!1,this.timeStamp=Date.now(),this.target=null}return e.prototype.stopImmediatePropagation=function(){},e.prototype.preventDefault=function(){this.defaultPrevented=!0},Object.defineProperty(e.prototype,"currentTarget",{get:function(){return this.target},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"srcElement",{get:function(){return this.target},enumerable:!1,configurable:!0}),e.prototype.composedPath=function(){return this.target?[this.target]:[]},Object.defineProperty(e.prototype,"returnValue",{get:function(){return!this.defaultPrevented},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eventPhase",{get:function(){return this.target?Event.AT_TARGET:Event.NONE},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cancelBubble",{get:function(){return!1},set:function(e){e&&this.stopPropagation()},enumerable:!1,configurable:!0}),e.prototype.stopPropagation=function(){},e.prototype.initEvent=function(e,t,r){this.type=e,arguments.length>1&&(this.bubbles=!!t),arguments.length>2&&(this.cancelable=!!r)},e.NONE=0,e.CAPTURING_PHASE=1,e.AT_TARGET=2,e.BUBBLING_PHASE=3,e}();t.Event2=i,t.EventClass="undefined"!=typeof Event?Event:i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdbExtended=void 0;var n=r(0),i=n.__importDefault(r(43)),o=r(44),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.createClient=function(e){void 0===e&&(e={});var t={bin:e.bin,host:e.host||process.env.ADB_HOST||"127.0.0.1",port:e.port||0};if(!t.port){var r=parseInt(process.env.ADB_PORT||"",10);isNaN(r)?t.port=5037:t.port=r}return new o.ExtendedClient(t)},t}(i.default);t.AdbExtended=s},function(e,t){e.exports=require("@devicefarmer/adbkit/lib/adb/protocol")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Config=void 0;var n=r(0),i=n.__importStar(r(25)),o=n.__importStar(r(26)),s=n.__importStar(r(4)),a=r(27),u=n.__importDefault(r(28)),c=/^.+\.(yaml|yml)$/i,l=/^.+\.(json|js)$/i,d=function(){function e(e){this.fullConfig=e;var t=i.env[a.EnvName.CONFIG_PATH];if(t)if(t.match(c))this.fullConfig=u.default.parse(this.readFile(t));else{if(!t.match(l))throw Error("Unknown file type: "+t);this.fullConfig=JSON.parse(this.readFile(t))}}return e.getInstance=function(t){return t||((t={runGoogTracker:!1,runApplTracker:!1,announceGoogTracker:!1,announceApplTracker:!1}).runGoogTracker=!0,t.announceGoogTracker=!0),this.instance||(this.instance=new e(t)),this.instance},e.prototype.readFile=function(e){var t=e.startsWith("/")?e:s.resolve(i.cwd(),e);if(!o.existsSync(t))throw Error("Can't find file \""+t+'"');return o.readFileSync(t).toString()},e.prototype.getHostList=function(){if(!this.fullConfig.remoteHostList||!this.fullConfig.remoteHostList.length)return[];var e=[];return this.fullConfig.remoteHostList.forEach((function(t){var r=t.hostname,n=t.port,i=t.secure,o=t.useProxy;Array.isArray(t.type)?t.type.forEach((function(t){e.push({hostname:r,port:n,secure:i,useProxy:o,type:t})})):e.push({hostname:r,port:n,secure:i,useProxy:o,type:t.type})})),e},e.prototype.getRunLocalGoogTracker=function(){return!!this.fullConfig.runGoogTracker},e.prototype.getAnnounceLocalGoogTracker=function(){return"boolean"==typeof this.fullConfig.announceGoogTracker?this.fullConfig.announceGoogTracker:!0===this.fullConfig.runGoogTracker},e.prototype.getRunLocalApplTracker=function(){return!!this.fullConfig.runApplTracker},e.prototype.getAnnounceLocalApplTracker=function(){return"boolean"==typeof this.fullConfig.announceApplTracker?this.fullConfig.announceApplTracker:!0===this.fullConfig.runApplTracker},e.prototype.getServers=function(){return Array.isArray(this.fullConfig.server)?this.fullConfig.server:[{secure:!1,port:8e3}]},e}();t.Config=d},function(e,t){e.exports=require("os")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HttpServer=void 0;var n=r(0),i=n.__importStar(r(13)),o=n.__importStar(r(29)),s=n.__importDefault(r(4)),a=r(30),u=n.__importDefault(r(31)),c=r(10),l=r(5),d=s.default.join(__dirname,"./public"),f=function(e){function t(){var t=e.call(this)||this;return t.servers=[],t.started=!1,t}return n.__extends(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.hasInstance=function(){return!!this.instance},t.setPublicDir=function(e){if(t.instance)throw Error("Unable to change value after instantiation");t.PUBLIC_DIR=e},t.setServeStatic=function(e){if(t.instance)throw Error("Unable to change value after instantiation");t.SERVE_STATIC=e},t.prototype.getServers=function(){return n.__awaiter(this,void 0,void 0,(function(){var e=this;return n.__generator(this,(function(t){return this.started?[2,n.__spread(this.servers)]:[2,new Promise((function(t){e.once("started",(function(){t(n.__spread(e.servers))}))}))]}))}))},t.prototype.getName=function(){return"HTTP(s) Server Service"},t.prototype.start=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,r=this;return n.__generator(this,(function(s){return this.mainApp=u.default(),t.SERVE_STATIC&&t.PUBLIC_DIR&&this.mainApp.use(u.default.static(t.PUBLIC_DIR)),(e=c.Config.getInstance()).getServers().forEach((function(t){var s,c,l=t.secure,d=t.port,f=t.redirectToSecure;if(l){if(!t.options)throw Error("Must provide option for secure server configuration");var h=t.options,p=h.key,v=h.cert,_=t.options,E=_.keyPath,m=_.certPath;if(!p){if("string"!=typeof E)throw Error('Must provide parameter "key" or "keyPath"');p=e.readFile(E)}if(!v){if("string"!=typeof m)throw Error('Must provide parameter "cert" or "certPath"');v=e.readFile(m)}var g=n.__assign(n.__assign({},t.options),{cert:v,key:p});c=o.createServer(g,r.mainApp),s="https"}else{g=t.options?n.__assign({},t.options):{};s="http";var y=r.mainApp,S="",T=443,R=!1;!0===f?R=!0:"object"==typeof f&&(R=!0,"number"==typeof f.port&&(T=f.port),"string"==typeof f.host&&(S=f.host)),R&&(y=u.default()).use((function(e,t){var r=new URL("https://"+(S||e.headers.host)+e.url);return T&&443!==T&&(r.port=T.toString()),t.redirect(301,r.toString())})),c=i.createServer(g,y)}r.servers.push({server:c,port:d}),c.listen(d,(function(){a.Utils.printListeningMsg(s,d)}))})),this.started=!0,this.emit("started",!0),[2]}))}))},t.prototype.release=function(){this.servers.forEach((function(e){e.server.close()}))},t.PUBLIC_DIR=d,t.SERVE_STATIC=!0,t}(l.TypedEmitter);t.HttpServer=f},function(e,t){e.exports=require("http")},function(e,t){e.exports=require("ws")},function(e,t){e.exports=require("url")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebsocketProxy=void 0;var n=r(0),i=r(1),o=n.__importDefault(r(14)),s=r(2),a=function(e){function t(t){var r=e.call(this,t)||this;return r.released=!1,r.storage=[],r}return n.__extends(t,e),t.processRequest=function(e,t){var r=t.parsedQuery;if(r&&r.action===s.ACTION.PROXY_WS){if("string"==typeof r.ws)return this.createProxy(e,r.ws);e.close(4003,"["+this.TAG+'] Invalid value "'+e+'" for "ws" parameter')}},t.createProxy=function(e,r){var n=this,i=new t(e);return i.init(r).catch((function(t){var r="["+n.TAG+"] Failed to start service: "+t.message;console.error(r),e.close(4005,r)})),i},t.prototype.init=function(e){return n.__awaiter(this,void 0,void 0,(function(){var r,i=this;return n.__generator(this,(function(n){return this.name="["+t.TAG+"{$"+e+"}]",(r=new o.default(e)).onopen=function(){i.remoteSocket=r,i.flush()},r.onmessage=function(e){i.ws&&i.ws.readyState===i.ws.OPEN&&(Array.isArray(e.data)?e.data.forEach((function(e){return i.ws.send(e)})):i.ws.send(e.data))},r.onclose=function(e){i.ws.readyState===i.ws.OPEN&&i.ws.close(e.wasClean?1e3:4010)},r.onerror=function(e){i.ws.readyState===i.ws.OPEN&&i.ws.close(4011,e.message)},[2]}))}))},t.prototype.flush=function(){if(this.remoteSocket){for(;this.storage.length;){var e=this.storage.shift();e&&e.data&&this.remoteSocket.send(e.data)}this.released&&this.remoteSocket.close()}this.storage.length=0},t.prototype.onSocketMessage=function(e){this.remoteSocket?this.remoteSocket.send(e.data):this.storage.push(e)},t.prototype.release=function(){this.released||(e.prototype.release.call(this),this.released=!0,this.flush())},t.TAG="WebsocketProxy",t}(i.Mw);t.WebsocketProxy=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageType=void 0,function(e){e[e.CreateChannel=4]="CreateChannel",e[e.CloseChannel=8]="CloseChannel",e[e.RawBinaryData=16]="RawBinaryData",e[e.RawStringData=32]="RawStringData",e[e.Data=64]="Data"}(t.MessageType||(t.MessageType={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CloseEventClass=t.CloseEvent2=void 0;var n=r(0),i=function(e){function t(t,r){var n=void 0===r?{}:r,i=n.code,o=n.reason,s=e.call(this,t)||this;return s.code=i||0,s.reason=o||"",s.wasClean=0===s.code,s}return n.__extends(t,e),t}(r(7).Event2);t.CloseEvent2=i,t.CloseEventClass="undefined"!=typeof CloseEvent?CloseEvent:i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlCenter=void 0;var n=r(0),i=r(42),o=r(8),s=r(56),a=r(20),u=n.__importStar(r(11)),c=n.__importStar(r(57)),l=r(58),d=function(e){function t(){var r=e.call(this)||this;r.initialized=!1,r.client=o.AdbExtended.createClient(),r.waitAfterError=1e3,r.deviceMap=new Map,r.descriptors=new Map,r.restartTracker=function(){r.restartTimeoutId||(console.log("Device tracker is down. Will try to restart in "+r.waitAfterError+"ms"),r.restartTimeoutId=setTimeout((function(){r.stopTracker(),r.waitAfterError*=1.2,r.init()}),r.waitAfterError))},r.onChangeSet=function(e){var i,o,s,a,u,c;if(r.waitAfterError=t.defaultWaitAfterError,e.added.length)try{for(var d=n.__values(e.added),f=d.next();!f.done;f=d.next()){var h=(g=f.value).id,p=g.type;r.handleConnected(h,p)}}catch(e){i={error:e}}finally{try{f&&!f.done&&(o=d.return)&&o.call(d)}finally{if(i)throw i.error}}if(e.removed.length)try{for(var v=n.__values(e.removed),_=v.next();!_.done;_=v.next()){h=(g=_.value).id;r.handleConnected(h,l.DeviceState.DISCONNECTED)}}catch(e){s={error:e}}finally{try{_&&!_.done&&(a=v.return)&&a.call(v)}finally{if(s)throw s.error}}if(e.changed.length)try{for(var E=n.__values(e.changed),m=E.next();!m.done;m=E.next()){var g;h=(g=m.value).id,p=g.type;r.handleConnected(h,p)}}catch(e){u={error:e}}finally{try{m&&!m.done&&(c=E.return)&&c.call(E)}finally{if(u)throw u.error}}},r.onDeviceUpdate=function(e){var t=e.udid,n=e.descriptor;r.descriptors.set(t,n),r.emit("device",n)},console.log("in ControlCenter");var i="goog|"+u.hostname()+"|"+u.uptime();return r.id=c.createHash("md5").update(i).digest("hex"),console.log(r.id),r}return n.__extends(t,e),t.getInstance=function(){return this.instance||(this.instance=new t),this.instance},t.hasInstance=function(){return!!t.instance},t.prototype.handleConnected=function(e,t){var r=this.deviceMap.get(e);r?r.setState(t):((r=new i.Device(e,t)).on("update",this.onDeviceUpdate),this.deviceMap.set(e,r))},t.prototype.init=function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,r=this;return n.__generator(this,(function(n){switch(n.label){case 0:return console.log("in init"),this.initialized?[2]:(e=this,[4,this.startTracker()]);case 1:return e.tracker=n.sent(),[4,this.client.listDevices()];case 2:return t=n.sent(),console.log(JSON.stringify(t)),t.forEach((function(e){var t=e.id,n=e.type;r.handleConnected(t,n)})),this.initialized=!0,[2]}}))}))},t.prototype.startTracker=function(){return n.__awaiter(this,void 0,void 0,(function(){var e;return n.__generator(this,(function(t){switch(t.label){case 0:return this.tracker?[2,this.tracker]:[4,this.client.trackDevices()];case 1:return(e=t.sent()).on("changeSet",this.onChangeSet),e.on("end",this.restartTracker),e.on("error",this.restartTracker),[2,e]}}))}))},t.prototype.stopTracker=function(){this.tracker&&(this.tracker.off("changeSet",this.onChangeSet),this.tracker.off("end",this.restartTracker),this.tracker.off("error",this.restartTracker),this.tracker.end(),this.tracker=void 0),this.tracker=void 0,this.initialized=!1},t.prototype.getDevices=function(){return Array.from(this.descriptors.values())},t.prototype.getDevice=function(e){return this.deviceMap.get(e)},t.prototype.getId=function(){return this.id},t.prototype.getName=function(){return"aDevice Tracker ["+u.hostname()+"]"},t.prototype.start=function(){var e=this;return this.init().catch((function(t){console.error('Error: Failed to init "'+e.getName()+'". '+t.message)}))},t.prototype.release=function(){this.stopTracker()},t.prototype.runCommand=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i;return n.__generator(this,(function(n){switch(n.label){case 0:if(t=e.getUdid(),!(r=this.getDevice(t)))return console.error('Device with udid:"'+t+'" not found'),[2];switch(i=e.getType(),i){case a.ControlCenterCommand.KILL_SERVER:return[3,1];case a.ControlCenterCommand.START_SERVER:return[3,3];case a.ControlCenterCommand.UPDATE_INTERFACES:return[3,5]}return[3,7];case 1:return[4,r.killServer(e.getPid())];case 2:return n.sent(),[2];case 3:return[4,r.startServer()];case 4:return n.sent(),[2];case 5:return[4,r.updateInterfaces()];case 6:return n.sent(),[2];case 7:throw new Error('Unsupported command: "'+i+'"')}}))}))},t.defaultWaitAfterError=1e3,t}(s.BaseControlCenter);t.ControlCenter=d},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlCenterCommand=void 0;var n=function(){function e(){this.id=-1,this.type="",this.pid=0,this.udid="",this.method=""}return e.fromJSON=function(t){var r=JSON.parse(t);if(!r)throw new Error("Invalid input");var n=new e,i=n.data=r.data;switch(n.id=r.id,n.type=r.type,"string"==typeof i.udid&&(n.udid=i.udid),r.type){case this.KILL_SERVER:if("number"!=typeof i.pid&&i.pid<=0)throw new Error('Invalid "pid" value');return n.pid=i.pid,n;case this.REQUEST_WDA:if("string"!=typeof i.method)throw new Error('Invalid "method" value');return n.method=i.method,n.args=i.args,n;case this.START_SERVER:case this.UPDATE_INTERFACES:case this.CONFIGURE_STREAM:case this.RUN_WDA:return n;default:throw new Error('Unknown command "'+r.command+'"')}},e.prototype.getType=function(){return this.type},e.prototype.getPid=function(){return this.pid},e.prototype.getUdid=function(){return this.udid},e.prototype.getId=function(){return this.id},e.prototype.getMethod=function(){return this.method},e.prototype.getData=function(){return this.data},e.prototype.getArgs=function(){return this.args},e.KILL_SERVER="kill_server",e.START_SERVER="start_server",e.UPDATE_INTERFACES="update_interfaces",e.CONFIGURE_STREAM="configure_stream",e.RUN_WDA="run-wda",e.REQUEST_WDA="request-wda",e}();t.ControlCenterCommand=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AdbUtils=void 0;var n=r(0),i=n.__importStar(r(65)),o=n.__importStar(r(13)),s=n.__importStar(r(4)),a=r(2),u=r(8),c=r(15),l=n.__importDefault(r(66)),d=n.__importDefault(r(9)),f="127.0.0.1:6666",h=/127\.0\.0\.1:6666/,p=function(){function e(){}return e.formatStatsMin=function(e){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){return[2,{name:e.name,isDir:e.isDirectory()?1:0,size:e.size,dateModified:e.mtimeMs?e.mtimeMs:e.mtime.getTime()}]}))}))},e.push=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,(i=u.AdbExtended.createClient()).push(e,t,r)];case 1:return o=n.sent(),i.on("error",(function(e){o.emit("error",e)})),[2,o]}}))}))},e.stats=function(e,t,r,i){return void 0===i&&(i=0),n.__awaiter(this,void 0,void 0,(function(){var o;return n.__generator(this,(function(n){switch(n.label){case 0:return!r||r.isSymbolicLink()&&t.endsWith("/")?[4,u.AdbExtended.createClient().stat(e,t)]:[3,2];case 1:r=n.sent(),n.label=2;case 2:if(!r.isSymbolicLink())return[3,7];if(5===i)throw Error("Too deep");t.endsWith("/")||(t+="/"),n.label=3;case 3:return n.trys.push([3,5,,6]),[4,this.stats(e,t,r,i++)];case 4:return r=n.sent(),[3,6];case 5:if("Too deep"===(o=n.sent()).message){if(0===i)return console.error("Symlink is too deep: "+t),[2,r];throw o}return"ENOENT"!==o.code&&console.error(o.message),[3,6];case 6:case 7:return[2,r]}}))}))},e.readdir=function(t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o,a=this;return n.__generator(this,(function(c){switch(c.label){case 0:return[4,u.AdbExtended.createClient().readdir(t,r)];case 1:return i=c.sent(),o=i.map((function(i){return n.__awaiter(a,void 0,void 0,(function(){var o,a;return n.__generator(this,(function(n){switch(n.label){case 0:return i.isSymbolicLink()?[4,this.stats(t,s.join(r,i.name))]:[3,2];case 1:o=n.sent(),a=o.mtimeMs?o.mtimeMs:o.mtime.getTime(),i=new l.default(i.name,o.mode,o.size,a/1e3|0),n.label=2;case 2:return[2,e.formatStatsMin(i)]}}))}))})),[2,Promise.all(o)]}}))}))},e.pipePullFile=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,u.AdbExtended.createClient().pull(e,t)];case 1:return(r=n.sent()).on("progress",(function(r){console.log("[%s] [%s] Pulled %d bytes so far",e,t,r.bytesTransferred)})),r.on("end",(function(){console.log("[%s] [%s] Pull complete",e,t)})),[2,new Promise((function(e,t){r.on("readable",(function(){e(r)})),r.on("error",(function(e){t(e)}))}))]}}))}))},e.pipeStatToStream=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){return[2,u.AdbExtended.createClient().pipeStat(e,t,r)]}))}))},e.pipeReadDirToStream=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){return[2,u.AdbExtended.createClient().pipeReadDir(e,t,r)]}))}))},e.pipePullFileToStream=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,u.AdbExtended.createClient().pull(e,t)];case 1:return(i=n.sent()).on("data",(function(e){r.send(Buffer.concat([Buffer.from(d.default.DATA,"ascii"),e]))})),[2,new Promise((function(e,t){i.on("end",(function(){r.send(Buffer.from(d.default.DONE,"ascii")),r.close(),e()})),i.on("error",(function(e){t(e)}))}))]}}))}))},e.forward=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,o,s,a,c,l;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,(r=u.AdbExtended.createClient()).listForwards(e)];case 1:return o=n.sent(),(s=o.find((function(r){return r.remote===t&&r.local.startsWith("tcp:")&&r.serial===e})))?(a=s.local,[2,parseInt(a.split("tcp:")[1],10)]):[4,i.getPortPromise()];case 2:return c=n.sent(),l="tcp:"+c,[4,r.forward(e,l,t)];case 3:return n.sent(),[2,c]}}))}))},e.getDevtoolsRemoteList=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i,o;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,u.AdbExtended.createClient().shell(e,"cat /proc/net/unix")];case 1:return t=n.sent(),[4,u.AdbExtended.util.readAll(t)];case 2:return r=n.sent(),i=r.toString().split("\n").filter((function(e){return!!e&&e.includes("devtools_remote")})),o=[],i.forEach((function(e){var t=e.split(" ");if(8===t.length&&"01"===t[5]){var r=t[7].substr(1);o.push(r)}})),[2,o]}}))}))},e.createHttpRequest=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,s,a,c;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,u.AdbExtended.createClient().openLocal(e,"localabstract:"+t)];case 1:return i=n.sent(),s=new o.ClientRequest(r,{createConnection:function(){return i}}),[4,new Promise((function(e,t){s.on("response",(function(t){e(t)})),s.on("socket",(function(){s.end()})),s.on("error",(function(e){t(e)}))}))];case 2:return a=n.sent(),c="",[2,new Promise((function(e,t){a.on("data",(function(e){c+=e})),a.on("end",(function(){var t=a.statusCode;e({statusCode:t,contentType:a.headers["content-type"],body:c})})),a.on("error",(function(e){t(e)}))}))]}}))}))},e.parseResponse=function(e){if(!e)throw Error("empty response");var t=e.contentType,r=e.statusCode;if("number"!=typeof r||200!==r)throw Error("wrong status code: "+r);if(!(null==t?void 0:t.startsWith("application/json")))throw Error("wrong content type: "+t);return JSON.parse(e.body)},e.patchWebSocketDebuggerUrl=function(e,t,r,n){if(n){var i="localabstract:"+r,o=n.replace(/ws:\/\//,"").replace(h,"");return e+"/"+a.ACTION.PROXY_ADB+"/"+t+"/"+i+"/"+o}return n},e.getRemoteDevtoolsVersion=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.createHttpRequest(t,r,"http://"+f+"/json/version")];case 1:if(!(i=n.sent()))throw Error("Empty response");return(o=this.parseResponse(i)).webSocketDebuggerUrl&&(o.webSocketDebuggerUrl=this.patchWebSocketDebuggerUrl(e,t,r,o.webSocketDebuggerUrl)),[2,o]}}))}))},e.getRemoteDevtoolsTargets=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o,s=this;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.createHttpRequest(t,r,"http://"+f+"/json")];case 1:return i=n.sent(),(o=this.parseResponse(i))&&o.length?[2,o.map((function(n){var i=n.devtoolsFrontendUrl,o=n.webSocketDebuggerUrl;if(i){var a=i,u=!1,l=s.patchWebSocketDebuggerUrl(e,t,r,o);a.startsWith("http")||(u=!0,a="http://"+f+a);var d=new c.URL(a);d.searchParams.delete("ws");var h=d.toString();h.includes("?")?h+="&":h+="?",h+="ws="+l,u&&(h=h.substr(("http://"+f).length)),n.devtoolsFrontendUrl=h,n.webSocketDebuggerUrl=l}return n}))]:[2,[]]}}))}))},e.getRemoteDevtoolsInfo=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,i,o,s=this;return n.__generator(this,(function(a){switch(a.label){case 0:return[4,this.getDevtoolsRemoteList(t)];case 1:return(r=a.sent())&&r.length?[3,3]:[4,this.getDeviceName(t)];case 2:return[2,{deviceName:a.sent(),deviceSerial:t,browsers:[]}];case 3:return i=[],r.forEach((function(r){var o=s.getRemoteDevtoolsVersion(e,t,r).catch((function(e){return console.error("getRemoteDevtoolsVersion failed:",e.message),{"Android-Package":"string",Browser:"string","Protocol-Version":"string","User-Agent":"string","V8-Version":"string","WebKit-Version":"string",webSocketDebuggerUrl:"string"}})),a=s.getRemoteDevtoolsTargets(e,t,r).catch((function(e){return console.error("getRemoteDevtoolsTargets failed:",e.message),console.error("getRemoteDevtoolsTargets failed:",e.message),[]})),u=Promise.all([o,a]).then((function(e){var t=n.__read(e,2),i=t[0],o=t[1];return{socket:r,version:i,targets:o}}));i.push(u)})),i.unshift(this.getDeviceName(t)),[4,Promise.all(i)];case 4:return o=a.sent(),[2,{deviceName:o.shift(),deviceSerial:t,browsers:o}]}}))}))},e.getDeviceName=function(e){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(t){switch(t.label){case 0:return[4,u.AdbExtended.createClient().getProperties(e)];case 1:return[2,t.sent()["ro.product.model"]||"Unknown device"]}}))}))},e}();t.AdbUtils=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);r(23);var i=n.__importStar(r(24)),o=r(10),s=r(12),a=r(33),u=r(16),c=r(35),l=r(37),d=[s.HttpServer,a.WebSocketServer],f=[u.WebsocketProxy,l.WebsocketMultiplexer],h=[c.HostTracker],p=[],v=[],_=o.Config.getInstance();v.push(function(){return n.__awaiter(this,void 0,void 0,(function(){var e,t,i,o,s,a;return n.__generator(this,(function(u){switch(u.label){case 0:return[4,Promise.resolve().then((function(){return n.__importStar(r(19))}))];case 1:return e=u.sent().ControlCenter,[4,Promise.resolve().then((function(){return n.__importStar(r(59))}))];case 2:return t=u.sent().DeviceTracker,[4,Promise.resolve().then((function(){return n.__importStar(r(60))}))];case 3:return i=u.sent().WebsocketProxyOverAdb,_.getRunLocalGoogTracker()&&h.push(t),_.getAnnounceLocalGoogTracker()&&c.HostTracker.registerLocalTracker(t),d.push(e),[4,Promise.resolve().then((function(){return n.__importStar(r(61))}))];case 4:return o=u.sent().RemoteShell,h.push(o),[4,Promise.resolve().then((function(){return n.__importStar(r(63))}))];case 5:return s=u.sent().RemoteDevtools,f.push(s),[4,Promise.resolve().then((function(){return n.__importStar(r(67))}))];case 6:return a=u.sent().FileListing,h.push(a),f.push(i),[2]}}))}))}()),Promise.all(v).then((function(){return d.map((function(e){var t=e.getInstance();return p.push(t),t.start()}))})).then((function(){var e=a.WebSocketServer.getInstance();f.forEach((function(t){e.registerMw(t)})),h.forEach((function(e){l.WebsocketMultiplexer.registerMw(e)})),"win32"===process.platform&&i.createInterface({input:process.stdin,output:process.stdout}).on("SIGINT",m),process.on("SIGINT",m),process.on("SIGTERM",m)})).catch((function(e){console.error(e.message),m("1")}));var E=!1;function m(e){if(console.log("\nReceived signal "+e),E)return console.log("Force exit"),void process.exit(0);E=!0,p.forEach((function(e){var t=e.getName();console.log("Stopping "+t+" ..."),e.release()}))}},function(e,t,r){"use strict";r.r(t),t.default=r.p+"LICENSE"},function(e,t){e.exports=require("readline")},function(e,t){e.exports=require("process")},function(e,t){e.exports=require("fs")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EnvName=void 0,function(e){e.CONFIG_PATH="WS_SCRCPY_CONFIG"}(t.EnvName||(t.EnvName={}))},function(e,t){e.exports=require("yaml")},function(e,t){e.exports=require("https")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Utils=void 0;var n=r(0).__importStar(r(11)),i=function(){function e(){}return e.printListeningMsg=function(e,t){var r=[],i=[];Object.keys(n.networkInterfaces()).map((function(e){return n.networkInterfaces()[e]})).forEach((function(n){n.forEach((function(n){var o;if("IPv6"===n.family)o=n.scopeid;else{if("IPv4"!==n.family)return;o=void 0}!function(n,o){void 0!==o?0===o&&i.push(e+"://["+n+"]:"+t):r.push(e+"://"+n+":"+t)}(n.address,o)}))}));var o=[encodeURI(e+"://"+n.hostname()+":"+t),encodeURI(e+"://localhost:"+t)];console.log("Listening on:\n\t"+o.join(" ")),r.length&&console.log("\t"+r.join(" ")),i.length&&console.log("\t"+i.join(" "))},e}();t.Utils=i},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("events")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebSocketServer=void 0;var n=r(0),i=r(14),o=n.__importDefault(r(34)),s=n.__importDefault(r(15)),a=r(12),u=function(){function e(){this.servers=[],this.mwFactories=new Set}return e.getInstance=function(){return this.instance||(this.instance=new e),this.instance},e.hasInstance=function(){return!!this.instance},e.prototype.registerMw=function(e){this.mwFactories.add(e)},e.prototype.attachToServer=function(e){var t=this,r=e.server,a="WebSocket Server {tcp:"+e.port+"}",u=new i.Server({server:r});return u.on("connection",(function(e,r){return n.__awaiter(t,void 0,void 0,(function(){var t,i,u,c,l,d,f,h;return n.__generator(this,(function(p){if(!r.url)return e.close(4001,"["+a+"] Invalid url"),[2];t=s.default.parse(r.url),i=o.default.parse(t.query||""),u=!1;try{for(c=n.__values(this.mwFactories.values()),l=c.next();!l.done;l=c.next())d=l.value,d.processRequest(e,{request:r,parsedUrl:t,parsedQuery:i})&&(u=!0)}catch(e){f={error:e}}finally{try{l&&!l.done&&(h=c.return)&&h.call(c)}finally{if(f)throw f.error}}return u||e.close(4002,"["+a+"] Unsupported request"),[2]}))}))})),u.on("close",(function(){console.log(a+" stopped")})),this.servers.push(u),u},e.prototype.getServers=function(){return this.servers},e.prototype.getName=function(){return"WebSocket Server Service"},e.prototype.start=function(){return n.__awaiter(this,void 0,void 0,(function(){var e=this;return n.__generator(this,(function(t){switch(t.label){case 0:return[4,a.HttpServer.getInstance().getServers()];case 1:return t.sent().forEach((function(t){e.attachToServer(t)})),[2]}}))}))},e.prototype.release=function(){this.servers.forEach((function(e){e.close()}))},e}();t.WebSocketServer=u},function(e,t){e.exports=require("querystring")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HostTracker=void 0;var n=r(0),i=r(1),o=r(10),s=r(36),a=r(6),u=function(e){function t(r){var n=e.call(this,r)||this,i=Array.from(t.localTrackers.keys()).map((function(e){return{type:e.type}}));if(!t.remoteHostItems){var a=o.Config.getInstance();t.remoteHostItems=Array.from(a.getHostList())}var u={id:-1,type:s.MessageType.HOSTS,data:{local:i,remote:t.remoteHostItems}};return n.sendMessage(u),n}return n.__extends(t,e),t.processChannel=function(e,r){if(r===a.ChannelCode.HSTS)return new t(e)},t.registerLocalTracker=function(e){this.localTrackers.add(e)},t.prototype.onSocketMessage=function(e){var t={id:-1,type:s.MessageType.ERROR,data:'Unsupported message: "'+e.data.toString()+'"'};this.sendMessage(t)},t.prototype.release=function(){e.prototype.release.call(this)},t.TAG="HostTracker",t.localTrackers=new Set,t}(i.Mw);t.HostTracker=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageType=void 0,function(e){e.HOSTS="hosts",e.ERROR="error"}(t.MessageType||(t.MessageType={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebsocketMultiplexer=void 0;var n=r(0),i=r(1),o=r(2),s=r(38),a=n.__importDefault(r(3)),u=function(e){function t(t){var r=e.call(this,t)||this;return r.multiplexer=s.Multiplexer.wrap(t),r}return n.__extends(t,e),t.processRequest=function(e,t){var r=t.parsedQuery;if(r&&r.action===o.ACTION.MULTIPLEX)return this.createMultiplexer(e)},t.createMultiplexer=function(e){var r=this,n=new t(e);return n.init().catch((function(t){var n="["+r.TAG+"] Failed to start service: "+t.message;console.error(n),e.close(4005,n)})),n},t.prototype.init=function(){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(e){return this.multiplexer.addEventListener("channel",this.onChannel),[2]}))}))},t.registerMw=function(e){this.mwFactories.add(e)},t.prototype.onSocketMessage=function(e){},t.prototype.onChannel=function(e){var r,i,o=e.channel,s=e.data,u=!1;try{for(var c=n.__values(t.mwFactories.values()),l=c.next();!l.done;l=c.next()){var d=l.value;try{var f=a.default.utf8ByteArrayToString(Buffer.from(s).slice(0,4)),h=s.byteLength>4?s.slice(4):void 0;d.processChannel(o,f,h)&&(u=!0)}finally{}}}catch(e){r={error:e}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(r)throw r.error}}u||o.close(4002,"["+t.TAG+"] Unsupported request")},t.prototype.release=function(){e.prototype.release.call(this)},t.TAG="WebsocketMultiplexer",t.mwFactories=new Set,t}(i.Mw);t.WebsocketMultiplexer=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Multiplexer=void 0;var n=r(0),i=r(5),o=r(39),s=r(17),a=r(7),u=r(18),c=r(40),l=r(41),d=n.__importDefault(r(3)),f=function(e){function t(r,n,i){void 0===n&&(n=0);var a=e.call(this)||this;a.ws=r,a._id=n,a.CONNECTING=0,a.OPEN=1,a.CLOSING=2,a.CLOSED=3,a.binaryType="blob",a.channels=new Map,a.nextId=0,a.maxId=4294967296,a.storage=[],a.emptyTimer=null,a.onclose=null,a.onerror=null,a.onmessage=null,a.onopen=null,a.url="",a.readyState=a.CONNECTING,0===a._id&&(r.binaryType="arraybuffer",a.readyState=a.ws.readyState),a.messageEmitter=i||r;var u=function(e){a.readyState=a.ws.readyState,a.dispatchEvent(e)},f=function(e){a.readyState=a.ws.readyState,a.dispatchEvent(e),a.channels.clear()},h=function(e){a.readyState=a.ws.readyState,a.dispatchEvent(e),a.channels.clear()},p=function(e){var t=e.data,r=o.Message.parse(t);switch(r.type){case s.MessageType.CreateChannel:var n=r.channelId,i=r.data;a.nextId<n&&(a.nextId=n);var u=a._createChannel(n,!1);a.emit("channel",{channel:u,data:i});break;case s.MessageType.RawStringData:var f=a.channels.get(r.channelId);if(f){u=f.channel;var h=new l.MessageEventClass("message",{data:d.default.utf8ByteArrayToString(Buffer.from(r.data)),lastEventId:e.lastEventId,origin:e.origin,source:e.source});u.dispatchEvent(h)}else console.error("Channel with id ("+r.channelId+") not found");break;case s.MessageType.RawBinaryData:var p=a.channels.get(r.channelId);if(p){u=p.channel,h=new l.MessageEventClass("message",{data:r.data,lastEventId:e.lastEventId,origin:e.origin,source:e.source});u.dispatchEvent(h)}else console.error("Channel with id ("+r.channelId+") not found");break;case s.MessageType.Data:var v=a.channels.get(r.channelId);if(v){var _=v.emitter;h=new l.MessageEventClass("message",{data:r.data,lastEventId:e.lastEventId,origin:e.origin,source:e.source});_.dispatchEvent(h)}else console.error("Channel with id ("+r.channelId+") not found");break;case s.MessageType.CloseChannel:var E=a.channels.get(r.channelId);if(E){(u=E.channel).readyState=u.CLOSING;try{u.dispatchEvent(r.toCloseEvent())}finally{u.readyState=u.CLOSED}}else console.error("Channel with id ("+r.channelId+") not found");break;default:var m=new Error("Unsupported message type: "+r.type);a.dispatchEvent(new c.ErrorEventClass("error",{error:m}))}},v=function(){if(a.storage.length){var e=a.ws;e instanceof t?a.storage.forEach((function(t){return e.sendData(t)})):a.storage.forEach((function(t){return e.send(t)})),a.storage.length=0}},_=function(){r.removeEventListener("open",u),r.removeEventListener("error",h),r.removeEventListener("close",f),a.messageEmitter.removeEventListener("message",p),a.off("close",_),a.off("open",v)};return r.addEventListener("open",u),r.addEventListener("error",h),r.addEventListener("close",f),a.messageEmitter.addEventListener("message",p),a.on("close",_),a.on("open",v),a.scheduleEmptyEvent(),a}return n.__extends(t,e),t.wrap=function(e){return new t(e)},Object.defineProperty(t.prototype,"bufferedAmount",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"extensions",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"protocol",{get:function(){return""},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._id},enumerable:!1,configurable:!0}),t.prototype.scheduleEmptyEvent=function(){var e=this;this.emptyTimer=setImmediate((function(){e.emptyTimer=null,e.emit("empty",e)}))},t.prototype.clearEmptyEvent=function(){this.emptyTimer&&(clearImmediate(this.emptyTimer),this.emptyTimer=null)},t.prototype.close=function(e,r){if(void 0===e&&(e=1e3),this.readyState!==this.CLOSED&&this.readyState!==this.CLOSING)if(this._id){this.readyState=this.CLOSING;try{var n=o.Message.fromCloseEvent(this._id,e,r).toBuffer();this.ws instanceof t?this.ws.sendData(n):this.ws.send(n),this.emit("close",new u.CloseEventClass("close",{code:e,reason:r}))}finally{this.readyState=this.CLOSED}}else this.ws.close(e,r)},t.prototype.send=function(e){this.ws instanceof t&&(e="string"==typeof e?o.Message.createBuffer(s.MessageType.RawStringData,this._id,Buffer.from(e)):o.Message.createBuffer(s.MessageType.RawBinaryData,this._id,Buffer.from(e))),this._send(e)},t.prototype.sendData=function(e){this.ws instanceof t&&(e=o.Message.createBuffer(s.MessageType.Data,this._id,Buffer.from(e))),this._send(e)},t.prototype._send=function(e){var r=this.readyState;if(r===this.OPEN)this.ws instanceof t?this.ws.sendData(e):this.ws.send(e);else{if(r!==this.ws.CONNECTING)throw Error("Socket is already in CLOSING or CLOSED state.");this.storage.push(e)}},t.prototype._createChannel=function(e,r){var n=this,o=new i.TypedEmitter,s=new t(this,e,o);return this.channels.set(e,{channel:s,emitter:o}),r?this.readyState===this.OPEN&&setImmediate((function(){s.readyState=n.OPEN,s.dispatchEvent(new a.EventClass("open"))})):s.readyState=this.readyState,s.addEventListener("close",(function(){n.channels.delete(e),n.channels.size||n.scheduleEmptyEvent()})),this.clearEmptyEvent(),s},t.prototype.createChannel=function(e){if(this.readyState===this.CLOSING||this.readyState===this.CLOSED)throw Error("Incorrect socket state");var t=this.getNextId(),r=this._createChannel(t,!0);return this.sendData(o.Message.createBuffer(s.MessageType.CreateChannel,t,e)),r},t.prototype.getNextId=function(){for(var e=!1;this.channels.has(++this.nextId);)if(this.nextId===this.maxId){if(e)throw Error("No available id");this.nextId=0,e=!0}return this.nextId},t.prototype.dispatchEvent=function(t){return"close"===t.type&&"function"==typeof this.onclose&&Reflect.apply(this.onclose,this,[t]),"open"===t.type&&"function"==typeof this.onopen&&Reflect.apply(this.onopen,this,[t]),"message"===t.type&&"function"==typeof this.onmessage&&Reflect.apply(this.onmessage,this,[t]),"error"===t.type&&"function"==typeof this.onerror&&Reflect.apply(this.onerror,this,[t]),e.prototype.dispatchEvent.call(this,t)},t}(i.TypedEmitter);t.Multiplexer=f},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message=void 0;var n=r(0),i=r(17),o=n.__importDefault(r(3)),s=r(18),a=function(){function e(e,t,r){this.type=e,this.channelId=t,this.data=r}return e.parse=function(t){var r=Buffer.from(t);return new e(r.readUInt8(0),r.readUInt32LE(1),t.slice(5))},e.fromCloseEvent=function(t,r,n){var s=n?o.default.stringToUtf8ByteArray(n):Buffer.alloc(0),a=Buffer.alloc(6+s.byteLength);return a.writeUInt16LE(r,0),s.byteLength&&(a.writeUInt32LE(s.byteLength,2),a.set(s,6)),new e(i.MessageType.CloseChannel,t,a)},e.createBuffer=function(e,t,r){var n=Buffer.alloc(5+(r?r.byteLength:0));return n.writeUInt8(e,0),n.writeUInt32LE(t,1),(null==r?void 0:r.byteLength)&&n.set(Buffer.from(r),5),n},e.prototype.toCloseEvent=function(){var e,t;if(this.data&&this.data.byteLength){var r=Buffer.from(this.data);if(e=r.readUInt16LE(0),r.byteLength>6){var n=r.readUInt32LE(2);t=o.default.utf8ByteArrayToString(r.slice(6,6+n))}}return new s.CloseEventClass("close",{code:e,reason:t,wasClean:1e3===e})},e.prototype.toBuffer=function(){return e.createBuffer(this.type,this.channelId,this.data)},e}();t.Message=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ErrorEventClass=t.ErrorEvent2=void 0;var n=r(0),i=function(e){function t(t,r){var n=void 0===r?{}:r,i=n.colno,o=n.error,s=n.filename,a=n.lineno,u=n.message,c=e.call(this,t)||this;return c.error=o,c.colno=i||0,c.filename=s||"",c.lineno=a||0,c.message=u||"",c}return n.__extends(t,e),t}(r(7).Event2);t.ErrorEvent2=i,t.ErrorEventClass="undefined"!=typeof ErrorEvent?ErrorEvent:i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MessageEventClass=t.MessageEvent2=void 0;var n=r(0),i=function(e){function t(t,r){var i=void 0===r?{}:r,o=i.data,s=void 0===o?null:o,a=i.origin,u=void 0===a?"":a,c=i.lastEventId,l=void 0===c?"":c,d=i.source,f=void 0===d?null:d,h=i.ports,p=void 0===h?[]:h,v=e.call(this,t)||this;return v.data=s,v.origin=""+u,v.lastEventId=""+l,v.source=f,v.ports=n.__spread(p),v}return n.__extends(t,e),t}(r(7).Event2);t.MessageEvent2=i,t.MessageEventClass="undefined"!=typeof MessageEvent?MessageEvent:i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Device=void 0;var n,i=r(0),o=r(8),s=r(49),a=r(5),u=r(50),c=r(55);!function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.PIDOF=1]="PIDOF",e[e.GREP_PS=2]="GREP_PS",e[e.GREP_PS_A=3]="GREP_PS_A",e[e.LS_PROC=4]="LS_PROC"}(n||(n={}));var l=function(e){function t(r,i){var s=e.call(this)||this;return s.udid=r,s.connected=!0,s.pidDetectionVariant=n.UNKNOWN,s.spawnServer=!0,s.updateTimeout=t.INITIAL_UPDATE_TIMEOUT,s.updateCount=0,s.lastEmit=0,s.interfacesSort=function(e,t){return e.name>t.name?1:e.name<t.name?-1:0},s.fetchDeviceInfo=function(){if(s.connected){var e=s.getProperties().then((function(e){if(!e)return!1;var t=!1;return c.Properties.forEach((function(r){e[r]!==s.descriptor[r]&&(t=!0,s.descriptor[r]=e[r])})),t&&s.emitUpdate(),!0})),r=s.updateInterfaces().then((function(e){return!!e.length})),n=(s.spawnServer?s.startServer():s.getServerPid()).then((function(){return!(-1===s.descriptor.pid&&s.spawnServer)}));Promise.all([e,r,n]).then((function(e){s.updateTimeoutId=void 0,e.filter((function(e){return!e})).length?s.scheduleInfoUpdate():(s.updateCount=0,s.updateTimeout=t.INITIAL_UPDATE_TIMEOUT)})).catch((function(){s.updateTimeoutId=void 0,s.scheduleInfoUpdate()}))}else s.updateCount=0,s.updateTimeout=t.INITIAL_UPDATE_TIMEOUT,s.updateTimeoutId=void 0,s.emitUpdate()},console.log("in device"),s.TAG="["+r+"]",s.descriptor={udid:r,state:i,interfaces:[],pid:-1,"wifi.interface":"","ro.build.version.release":"","ro.build.version.sdk":"","ro.product.manufacturer":"","ro.product.model":"","ro.product.cpu.abi":"","last.update.timestamp":0},s.client=o.AdbExtended.createClient(),console.log(JSON.stringify(s.client)),s.setState(i),s}return i.__extends(t,e),t.prototype.setState=function(e){"device"===e?(this.connected=!0,this.properties=void 0):this.connected=!1,this.descriptor.state=e,this.emitUpdate(),this.fetchDeviceInfo()},t.prototype.isConnected=function(){return this.connected},t.prototype.getPidOf=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t;return i.__generator(this,(function(r){switch(r.label){case 0:return this.connected?this.pidDetectionVariant!==n.UNKNOWN?[3,2]:(t=this,[4,this.findDetectionVariant()]):[2];case 1:t.pidDetectionVariant=r.sent(),r.label=2;case 2:switch(this.pidDetectionVariant){case n.PIDOF:return[2,this.pidOf(e)];case n.GREP_PS:return[2,this.grepPs(e)];case n.GREP_PS_A:return[2,this.grepPs_A(e)];default:return[2,this.listProc(e)]}return[2]}}))}))},t.prototype.killProcess=function(e){var t="kill "+e;return this.runShellCommandAdbKit(t)},t.prototype.runShellCommandAdb=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(r){return[2,new Promise((function(r,n){var i=["-s",""+t.udid,"shell",e],o=s.spawn("adb",i,{stdio:["ignore","pipe","pipe"]}),a="";o.stdout.on("data",(function(e){a+=e.toString(),console.log(t.TAG,"stdout: "+e.toString().replace(/\n$/,""))})),o.stderr.on("data",(function(e){console.error(t.TAG,"stderr: "+e)})),o.on("error",(function(e){console.error(t.TAG,"failed to spawn adb process.\n"+e.stack),n(e)})),o.on("close",(function(e){console.log(t.TAG,"adb process ("+i.join(" ")+") exited with code "+e),r(a)}))}))]}))}))},t.prototype.runShellCommandAdbKit=function(e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return[2,this.client.shell(this.udid,e).then(o.AdbExtended.util.readAll).then((function(e){return e.toString().trim()}))]}))}))},t.prototype.push=function(e,t){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(r){return[2,this.client.push(this.udid,e,t)]}))}))},t.prototype.getProperties=function(){return i.__awaiter(this,void 0,void 0,(function(){var e;return i.__generator(this,(function(t){switch(t.label){case 0:return this.properties?[2,this.properties]:this.connected?(e=this,[4,this.client.getProperties(this.udid)]):[2];case 1:return e.properties=t.sent(),[2,this.properties]}}))}))},t.prototype.getNetInterfaces=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,t;return i.__generator(this,(function(r){switch(r.label){case 0:return this.connected?(e=[],[4,this.runShellCommandAdbKit("ip -4 -f inet -o a | grep 'scope global'")]):[2,[]];case 1:return t=r.sent(),t.split("\n").filter((function(e){return!!e})).forEach((function(t){var r=t.split(" ").filter((function(e){return!!e})),n=r[1],i=r[3].split("/")[0];e.push({name:n,ipv4:i})})),[2,e.sort(this.interfacesSort)]}}))}))},t.prototype.pidOf=function(e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return[2,this.runShellCommandAdbKit("pidof "+e).then((function(e){return e.split(" ").map((function(e){return parseInt(e,10)})).filter((function(e){return!isNaN(e)}))})).catch((function(){return[]}))]}))}))},t.prototype.filterPsOutput=function(e,t){var r=[];return t.split("\n").map((function(t){var n=t.trim().split(" ").filter((function(e){return e.length}));if(n[n.length-1]===e){var i=parseInt(n[1],10);isNaN(i)||r.push(i)}})),r},t.prototype.grepPs_A=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(r){return[2,this.runShellCommandAdbKit("ps -A | grep "+e).then((function(r){return t.filterPsOutput(e,r)})).catch((function(){return[]}))]}))}))},t.prototype.grepPs=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t=this;return i.__generator(this,(function(r){return[2,this.runShellCommandAdbKit("ps | grep "+e).then((function(r){return t.filterPsOutput(e,r)})).catch((function(){return[]}))]}))}))},t.prototype.listProc=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n;return i.__generator(this,(function(i){switch(i.label){case 0:return"find /proc -maxdepth 2 -name cmdline  2>/dev/null",[4,this.runShellCommandAdbKit("for L in `find /proc -maxdepth 2 -name cmdline  2>/dev/null`; do grep -sae '^"+e+"' $L 2>&1 >/dev/null && echo $L; done")];case 1:return t=i.sent(),r=/\/proc\/([0-9]+)\/cmdline/,n=[],t.split("\n").map((function(e){var t=e.trim().match(r);t&&n.push(parseInt(t[1],10))})),[2,n]}}))}))},t.prototype.executedWithoutError=function(e){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(t){return[2,this.runShellCommandAdbKit(e).then((function(e){return 0===parseInt(e,10)})).catch((function(){return!1}))]}))}))},t.prototype.hasPs=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2,this.executedWithoutError("ps | grep init 2>&1 >/dev/null; echo $?")]}))}))},t.prototype.hasPs_A=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){return[2,this.executedWithoutError("ps -A | grep init 2>&1 >/dev/null; echo $?")]}))}))},t.prototype.hasPidOf=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return[4,this.executedWithoutError("which pidof 2>&1 >/dev/null && echo $?")];case 1:return e.sent()?[2,this.runShellCommandAdbKit("echo $PPID; pidof init").then((function(e){var t=e.split("\n").filter((function(e){return e.length}));if(t.length<2)return!1;var r=t[0].replace("\r",""),n=t[1].split(" ");return!n.includes(r)&&n.includes("1")})).catch((function(){return!1}))]:[2,!1]}}))}))},t.prototype.findDetectionVariant=function(){return i.__awaiter(this,void 0,void 0,(function(){return i.__generator(this,(function(e){switch(e.label){case 0:return[4,this.hasPidOf()];case 1:return e.sent()?[2,n.PIDOF]:[4,this.hasPs_A()];case 2:return e.sent()?[2,n.GREP_PS_A]:[4,this.hasPs()];case 3:return e.sent()?[2,n.GREP_PS]:[2,n.LS_PROC]}}))}))},t.prototype.scheduleInfoUpdate=function(){this.updateTimeoutId||(++this.updateCount>t.MAX_UPDATES_COUNT?console.error(this.TAG,"The maximum number of attempts to fetch device info has been reached."):(this.updateTimeoutId=setTimeout(this.fetchDeviceInfo,this.updateTimeout),this.updateTimeout*=2))},t.prototype.emitUpdate=function(e){var t=this;void 0===e&&(e=!0);var r=Date.now(),n=r-this.lastEmit;if(e&&(this.descriptor["last.update.timestamp"]=r),n>300)return this.lastEmit=r,void this.emit("update",this);this.throttleTimeoutId||(this.throttleTimeoutId=setTimeout((function(){delete t.throttleTimeoutId,t.emitUpdate(!1)}),300-n))},t.prototype.getServerPid=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,t;return i.__generator(this,(function(r){switch(r.label){case 0:return[4,u.ScrcpyServer.getServerPid(this)];case 1:return e=r.sent(),t=Array.isArray(e)&&e.length?e[0]:-1,this.descriptor.pid!==t&&(this.descriptor.pid=t,this.emitUpdate()),-1!==t?[2,t]:[2]}}))}))},t.prototype.updateInterfaces=function(){return i.__awaiter(this,void 0,void 0,(function(){var e=this;return i.__generator(this,(function(t){return[2,this.getNetInterfaces().then((function(t){var r=!1,n=e.descriptor.interfaces;return n.length!==t.length?r=!0:n.forEach((function(e,n){e.name===t[n].name&&e.ipv4===t[n].ipv4||(r=!0)})),r&&(e.descriptor.interfaces=t,e.emitUpdate()),e.descriptor.interfaces}))]}))}))},t.prototype.killServer=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n;return i.__generator(this,(function(i){switch(i.label){case 0:return this.spawnServer=!1,[4,this.getServerPid()];case 1:if("number"!=typeof(t=i.sent()))return[2];t!==e&&console.error(this.TAG,"Requested to kill server with PID "+e+". Real server PID is "+t+"."),i.label=2;case 2:return i.trys.push([2,4,,5]),[4,this.killProcess(t)];case 3:return(r=i.sent())&&console.log(this.TAG,'kill server: "'+r+'"'),this.descriptor.pid=-1,this.emitUpdate(),[3,5];case 4:throw n=i.sent(),console.error(this.TAG,"Error: "+n.message),n;case 5:return[2]}}))}))},t.prototype.startServer=function(){return i.__awaiter(this,void 0,void 0,(function(){var e,t,r;return i.__generator(this,(function(n){switch(n.label){case 0:return console.log("in startserver adb Device "),this.spawnServer=!0,[4,this.getServerPid()];case 1:if("number"==typeof(e=n.sent()))return[2,e];n.label=2;case 2:return n.trys.push([2,4,,5]),[4,u.ScrcpyServer.run(this)];case 3:return(t=n.sent())&&console.log(this.TAG,'start server: "'+t+'"'),[2,this.getServerPid()];case 4:throw r=n.sent(),console.error(this.TAG,"Error: "+r.message),r;case 5:return[2]}}))}))},t.INITIAL_UPDATE_TIMEOUT=1500,t.MAX_UPDATES_COUNT=7,t}(a.TypedEmitter);t.Device=l},function(e,t){e.exports=require("@devicefarmer/adbkit/lib/adb")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedClient=void 0;var n=r(0),i=n.__importDefault(r(45)),o=r(46),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.pipeSyncService=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(r){switch(r.label){case 0:return[4,this.transport(e)];case 1:return t=r.sent(),[2,new o.SyncCommand(t).execute()]}}))}))},t.prototype.pipeReadDir=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.pipeSyncService(e)];case 1:return[2,(i=n.sent()).pipeReadDir(t,r).then((function(){i.end()}))]}}))}))},t.prototype.pipePull=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.pipeSyncService(e)];case 1:return[2,(i=n.sent()).pipePull(t,r).then((function(){i.end()}))]}}))}))},t.prototype.pipeStat=function(e,t,r){return n.__awaiter(this,void 0,void 0,(function(){var i;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.pipeSyncService(e)];case 1:return[2,(i=n.sent()).pipeStat(t,r).then((function(){i.end()}))]}}))}))},t}(i.default);t.ExtendedClient=s},function(e,t){e.exports=require("@devicefarmer/adbkit/lib/adb/client")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SyncCommand=void 0;var n=r(0),i=n.__importDefault(r(9)),o=n.__importDefault(r(47)),s=r(48),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.execute=function(){var e=this;return this._send("sync:"),this.parser.readAscii(4).then((function(t){switch(t){case i.default.OKAY:return new s.ExtendedSync(e.connection);case i.default.FAIL:return e.parser.readError();default:return e.parser.unexpected(t,"OKAY or FAIL")}}))},t}(o.default);t.SyncCommand=a},function(e,t){e.exports=require("@devicefarmer/adbkit/lib/adb/command")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedSync=void 0;var n=r(0),i=n.__importDefault(r(9)),o=function(){function e(e){this.connection=e,this.connection=e,this.parser=this.connection.parser}return e.prototype.pipeReadDir=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,o=this;return n.__generator(this,(function(s){return r=function(){return n.__awaiter(o,void 0,void 0,(function(){var e,o,s,a;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.parser.readAscii(4)];case 1:switch(e=n.sent(),e){case i.default.DENT:return[3,2];case i.default.DONE:return[3,5];case i.default.FAIL:return[3,7]}return[3,8];case 2:return[4,this.parser.readBytes(16)];case 3:return o=n.sent(),s=o.readUInt32LE(12),[4,this.parser.readBytes(s)];case 4:return a=n.sent(),t.send(Buffer.concat([Buffer.from(e),o,a])),[2,r()];case 5:return[4,this.parser.readBytes(16)];case 6:return n.sent(),t.close(0),[2];case 7:return[2,this._readError(t)];case 8:return[2,this.parser.unexpected(e,"DENT, DONE or FAIL")]}}))}))},this._sendCommandWithArg(i.default.LIST,e),[2,r()]}))}))},e.prototype.pipePull=function(e,t){return this._sendCommandWithArg(i.default.RECV,""+e),this._readData(t)},e.prototype.pipeStat=function(e,t){return n.__awaiter(this,void 0,void 0,(function(){var r,o;return n.__generator(this,(function(n){switch(n.label){case 0:return this._sendCommandWithArg(i.default.STAT,""+e),[4,this.parser.readAscii(4)];case 1:switch(r=n.sent(),r){case i.default.STAT:return[3,2];case i.default.FAIL:return[3,4]}return[3,5];case 2:return[4,this.parser.readBytes(12)];case 3:return o=n.sent(),t.send(Buffer.concat([Buffer.from(r),o])),t.close(1e3),[3,6];case 4:return[2,this._readError(t)];case 5:return[2,this.parser.unexpected(r,"STAT or FAIL")];case 6:return[2]}}))}))},e.prototype._readData=function(e){var t=this,r=function(){return n.__awaiter(t,void 0,void 0,(function(){var t,o,s,a;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.parser.readAscii(4)];case 1:switch(t=n.sent(),t){case i.default.DATA:return[3,2];case i.default.DONE:return[3,5];case i.default.FAIL:return[3,7]}return[3,8];case 2:return[4,this.parser.readBytes(4)];case 3:return o=n.sent(),s=o.readUInt32LE(0),[4,this.parser.readBytes(s)];case 4:return a=n.sent(),e.send(Buffer.concat([Buffer.from(t),a])),[2,r()];case 5:return[4,this.parser.readBytes(4)];case 6:return n.sent(),e.close(1e3),[2];case 7:return[2,this._readError(e)];case 8:return[2,this.parser.unexpected(t,"DATA, DONE or FAIL")]}}))}))};return r()},e.prototype._sendCommandWithArg=function(e,t){var r=Buffer.byteLength(t,"utf-8"),n=Buffer.alloc(e.length+4+r),i=0;return n.write(e,i,e.length),i+=e.length,n.writeUInt32LE(r,i),i+=4,n.write(t,i),this.connection.write(n)},e.prototype._readError=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r;return n.__generator(this,(function(n){switch(n.label){case 0:return[4,this.parser.readBytes(4)];case 1:return t=n.sent(),[4,this.parser.readAscii(t.readUInt32LE(0))];case 2:return r=n.sent(),e.close(4e3,r),[4,this.parser.end()];case 3:return n.sent(),[2]}}))}))},e.prototype.end=function(){return this.connection.end(),this},e}();t.ExtendedSync=o},function(e,t){e.exports=require("child_process")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ScrcpyServer=void 0;var n=r(0);r(51),r(52);var i=r(53),o=n.__importDefault(r(4)),s=r(54),a=o.default.join(__dirname,"vendor/Genymobile/scrcpy"),u="CLASSPATH=/data/local/tmp/scrcpy-server.jar nohup app_process "+i.ARGS_STRING,c=function(){function e(){}return e.copyServer=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t;return n.__generator(this,(function(r){return t=o.default.join(a,"scrcpy-server.jar"),"/data/local/tmp/scrcpy-server.jar",[2,e.push(t,"/data/local/tmp/scrcpy-server.jar")]}))}))},e.waitForServerPid=function(t,r){return n.__awaiter(this,void 0,void 0,(function(){var i,o,s,a,u,c,l,d,f,h=this;return n.__generator(this,(function(n){switch(n.label){case 0:return i=r.tryCounter,o=r.processExited,s=r.lookPidFile,o?[2]:(a=500+100*i,s?(u=e.PID_FILE_PATH,[4,t.runShellCommandAdbKit("test -f "+u+" && cat "+u)]):[3,4]);case 1:return(c=n.sent()).trim()?!(l=parseInt(c,10))||isNaN(l)?[3,3]:[4,this.getServerPid(t)]:[3,3];case 2:if(null==(d=n.sent())?void 0:d.includes(l))return[2,d];r.lookPidFile=!1,n.label=3;case 3:return[3,6];case 4:return[4,this.getServerPid(t)];case 5:if(f=n.sent(),Array.isArray(f)&&f.length)return[2,f];n.label=6;case 6:if(++r.tryCounter>5)throw new Error("Failed to start server");return[2,new Promise((function(e){setTimeout((function(){e(h.waitForServerPid(t,r))}),a)}))]}}))}))},e.getServerPid=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,o;return n.__generator(this,(function(n){switch(n.label){case 0:return e.isConnected()?[4,e.getPidOf(i.SERVER_PROCESS_NAME)]:[2];case 1:return t=n.sent(),Array.isArray(t)&&t.length?(r=[],o=t.map((function(t){return e.runShellCommandAdbKit("cat /proc/"+t+"/cmdline").then((function(n){var o=n.split("\0");if(o.length&&o[0]===i.SERVER_PROCESS_NAME){for(var a=o[0];o.length&&a!==i.SERVER_PACKAGE;)o.shift(),a=o[0];if(!(o.length<3)){var u=o[1];if(u===i.SERVER_VERSION)r.push(t);else{var c=new s.ServerVersion(u);if(c.isCompatible())new s.ServerVersion(i.SERVER_VERSION).gt(c)&&(console.log(e.TAG,"Found old server version running (PID: "+t+", Version: "+u+")"),console.log(e.TAG,"Perform kill now"),e.killProcess(t))}}}}))})),[4,Promise.all(o)]):[2];case 2:return n.sent(),[2,r]}}))}))},e.run=function(e){return n.__awaiter(this,void 0,void 0,(function(){var t,r,i;return n.__generator(this,(function(n){switch(n.label){case 0:return e.isConnected()?[4,this.getServerPid(e)]:[2];case 1:return t=n.sent(),Array.isArray(t)&&t.length?[2,t]:[4,this.copyServer(e)];case 2:return n.sent(),r={tryCounter:0,processExited:!1,lookPidFile:!0},(i=e.runShellCommandAdb(u)).then((function(t){e.isConnected()&&console.log(e.TAG,"Server exited:",t)})).catch((function(t){console.log(e.TAG,"Error:",t.message)})).finally((function(){r.processExited=!0})),[4,Promise.race([i,this.waitForServerPid(e,r)])];case 3:return t=n.sent(),Array.isArray(t)&&t.length?[2,t]:[2]}}))}))},e.PID_FILE_PATH="/data/local/tmp/ws_scrcpy.pid",e}();t.ScrcpyServer=c},function(e,t,r){"use strict";r.r(t),t.default=r.p+"vendor/Genymobile/scrcpy/scrcpy-server.jar"},function(e,t,r){"use strict";r.r(t),t.default=r.p+"vendor/Genymobile/scrcpy/LICENSE"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ARGS_STRING=t.SERVER_PROCESS_NAME=t.LOG_LEVEL=t.SERVER_TYPE=t.SERVER_VERSION=t.SERVER_PORT=t.SERVER_PACKAGE=void 0,t.SERVER_PACKAGE="com.genymobile.scrcpy.Server",t.SERVER_PORT=8886,t.SERVER_VERSION="1.19-ws2",t.SERVER_TYPE="web",t.LOG_LEVEL="ERROR";var n=[t.SERVER_VERSION,t.SERVER_TYPE,t.LOG_LEVEL,t.SERVER_PORT,!0];t.SERVER_PROCESS_NAME="app_process",t.ARGS_STRING="/ "+t.SERVER_PACKAGE+" "+n.join(" ")+" 2>&1 > /dev/null"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ServerVersion=void 0;var n=function(){function e(e){this.versionString=e,this.parts=[];var t=e.split("-"),r=t.shift();this.suffix=t.join("-"),r&&(this.parts=r.split(".")),this.compatible=this.suffix.startsWith("ws")&&this.parts.length>=2}return e.prototype.equals=function(e){var t="string"==typeof e?e:e.versionString;return this.versionString===t},e.prototype.gt=function(t){if(this.equals(t))return!1;"string"==typeof t&&(t=new e(t));for(var r=Math.min(this.parts.length,t.parts.length),n=0;n<r;n++)if(this.parts[n]>t.parts[n])return!0;return this.parts.length>t.parts.length||!(this.parts.length<t.parts.length)&&this.suffix>t.suffix},e.prototype.isCompatible=function(){return this.compatible},e}();t.ServerVersion=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Properties=void 0,t.Properties=["ro.product.cpu.abi","ro.product.manufacturer","ro.product.model","ro.build.version.release","ro.build.version.sdk","wifi.interface"]},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseControlCenter=void 0;var n=r(0),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t}(r(5).TypedEmitter);t.BaseControlCenter=i},function(e,t){e.exports=require("crypto")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceState=void 0,function(e){e.DEVICE="device",e.DISCONNECTED="disconnected",e.CONNECTED="Connected"}(t.DeviceState||(t.DeviceState={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DeviceTracker=void 0;var n=r(0),i=r(1),o=r(20),s=r(19),a=r(2),u=r(6),c=function(e){function t(r){var n=e.call(this,r)||this;return n.adt=s.ControlCenter.getInstance(),n.sendDeviceMessage=function(e){var t={device:e,id:n.id,name:n.adt.getName()};n.sendMessage({id:-1,type:"device",data:t})},n.buildAndSendMessage=function(e){var t={list:e,id:n.id,name:n.adt.getName()};n.sendMessage({id:-1,type:"devicelist",data:t})},n.id=n.adt.getId(),n.adt.init().then((function(){n.adt.on("device",n.sendDeviceMessage),n.buildAndSendMessage(n.adt.getDevices())})).catch((function(e){console.error("["+t.TAG+"] Error: "+e.message)})),n}return n.__extends(t,e),t.processChannel=function(e,r){if(r===u.ChannelCode.GTRC)return new t(e)},t.processRequest=function(e,r){var n;if((null===(n=r.parsedQuery)||void 0===n?void 0:n.action)===a.ACTION.GOOG_DEVICE_LIST)return new t(e)},t.prototype.onSocketMessage=function(e){var r;try{r=o.ControlCenterCommand.fromJSON(e.data.toString())}catch(r){return void console.error("["+t.TAG+"], Received message: "+e.data+". Error: "+r.message)}this.adt.runCommand(r).catch((function(r){console.error("["+t.TAG+"], Received message: "+e.data+". Error: "+r.message)}))},t.prototype.release=function(){e.prototype.release.call(this),this.adt.off("device",this.sendDeviceMessage)},t.TAG="DeviceTracker",t.type="android",t}(i.Mw);t.DeviceTracker=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.WebsocketProxyOverAdb=void 0;var n=r(0),i=r(16),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.processRequest=function(e,t){console.log("in processREquest");var r,n,o,s=new i.WebsocketProxy(e),a=t.parsedQuery;return n=a.remote,o=a.serverip,r=a.serverport,console.log(o+":"+r+n),s.init("ws://"+o+":"+r),s},t}(i.WebsocketProxy);t.WebsocketProxyOverAdb=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteShell=void 0;var n=r(0),i=r(1),o=n.__importStar(r(62)),s=n.__importStar(r(11)),a=r(2),u=r(6),c="win32"===s.platform(),l=!c,d=function(e){function t(t){var r=e.call(this,t)||this;return r.ws=t,r.initialized=!1,r.timeoutString=null,r.timeoutBuffer=null,r.terminated=!1,r.closeCode=1e3,r.closeReason="",r.handleMessage=function(e){return n.__awaiter(r,void 0,void 0,(function(){var t,r;return n.__generator(this,(function(n){return"shell"!==e.type||(t=e.data,"start"===(r=t.type)&&(this.term=this.createTerminal(t),this.initialized=!0),"stop"===r&&this.release()),[2]}))}))},r}return n.__extends(t,e),t.processChannel=function(e,r){if(r===u.ChannelCode.SHEL)return new t(e)},t.processRequest=function(e,r){var n;if((null===(n=r.parsedQuery)||void 0===n?void 0:n.action)===a.ACTION.SHELL)return new t(e)},t.prototype.createTerminal=function(e){var r=this,n=Object.assign({},process.env);n.COLORTERM="truecolor";var i=e.cols,s=void 0===i?80:i,a=e.rows,u=void 0===a?24:a,d=n.PWD||"/",f=c?"adb.exe":"adb",h=o.spawn(f,["-s",e.udid,"shell"],{name:"xterm-256color",cols:s,rows:u,cwd:d,env:n,encoding:null}),p=l?this.bufferUtf8(5):this.buffer(5);return h.on("data",p),h.on("exit",(function(e){r.closeCode=0===e?1e3:4500,r.closeReason="["+[t.TAG]+"] terminal process exited with code: "+e,r.timeoutString||r.timeoutBuffer?r.terminated=!0:r.ws.close(r.closeCode,r.closeReason)})),h},t.prototype.onSocketMessage=function(e){if(this.initialized){if(!this.term)return;return this.term.write(e.data)}var r;try{r=JSON.parse(e.data.toString())}catch(e){return void console.error("["+t.TAG+"]",e.message)}this.handleMessage(r).catch((function(e){console.error("["+t.TAG+"]",e.message)}))},t.prototype.buffer=function(e){var t=this,r="";return function(n){r+=n,t.timeoutString||(t.timeoutString=setTimeout((function(){t.ws.send(r),r="",t.timeoutString=null,t.terminated&&t.ws.close(t.closeCode,t.closeReason)}),e))}},t.prototype.bufferUtf8=function(e){var t=this,r=[],n=0;return function(i){r.push(i),n+=i.length,t.timeoutBuffer||(t.timeoutBuffer=setTimeout((function(){t.ws.send(Buffer.concat(r,n)),r=[],t.timeoutBuffer=null,n=0,t.terminated&&t.ws.close(t.closeCode,t.closeReason)}),e))}},t.prototype.release=function(){e.prototype.release.call(this),this.timeoutBuffer&&clearTimeout(this.timeoutBuffer),this.timeoutString&&clearTimeout(this.timeoutString),this.term&&this.term.kill()},t.TAG="RemoteShell",t}(i.Mw);t.RemoteShell=d},function(e,t){e.exports=require("node-pty")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteDevtools=void 0;var n=r(0),i=r(1),o=r(64),s=r(21),a=r(2),u=function(e){function t(t,r,n){var i=e.call(this,t)||this;return i.ws=t,i.host=r,i.udid=n,i}return n.__extends(t,e),t.processRequest=function(e,r){var n=r.request,i=r.parsedQuery;if(i.action===a.ACTION.DEVTOOLS){var o=n.headers.host,s=i.udid;if("string"==typeof s&&s){if("string"==typeof o&&o)return new t(e,o,s);e.close(4003,"["+this.TAG+'] Invalid value "'+o+'" in "Host" header')}else e.close(4003,"["+this.TAG+'] Invalid value "'+s+'" for "udid" parameter')}},t.prototype.onSocketMessage=function(e){var t,r=this;try{t=JSON.parse(e.data.toString())}catch(t){return void console.log("Received message: "+e.data)}if(t&&t.command){var n=t.command;switch(n){case o.RemoteDevtoolsCommand.LIST_DEVTOOLS:s.AdbUtils.getRemoteDevtoolsInfo(this.host,this.udid).then((function(e){r.ws.send(JSON.stringify({type:a.ACTION.DEVTOOLS,data:e}))})).catch((function(e){var t=e.message;console.error('Command: "'+n+'", error: '+t),r.ws.send(JSON.stringify({command:n,error:t}))}));break;default:console.warn('Unsupported command: "'+t.command+'"')}}else console.log("Received message: "+e.data)},t.TAG="RemoteDevtools",t}(i.Mw);t.RemoteDevtools=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RemoteDevtoolsCommand=void 0,function(e){e.LIST_DEVTOOLS="list_devtools"}(t.RemoteDevtoolsCommand||(t.RemoteDevtoolsCommand={}))},function(e,t){e.exports=require("portfinder")},function(e,t){e.exports=require("@devicefarmer/adbkit/lib/adb/sync/entry")},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileListing=void 0;var n=r(0),i=r(1),o=r(21),s=n.__importDefault(r(3)),a=n.__importDefault(r(9)),u=r(6),c=r(68),l=function(e){function t(r,n){var i=e.call(this,r)||this;return i.serial=n,i.name="FileListing",i.sendMessage=function(){throw Error("Do not use this method. You must send data over channels")},r.on("channel",(function(e){t.handleNewChannel(i.serial,e.channel,e.data)})),i}return n.__extends(t,e),t.processChannel=function(e,r,n){if(r===u.ChannelCode.FSLS&&n&&!(n.byteLength<4)){var i=Buffer.from(n),o=i.readInt32LE(0);return new t(e,s.default.utf8ByteArrayToString(i.slice(4,4+o)))}},t.prototype.onSocketMessage=function(){},t.handleNewChannel=function(e,r,n){var i=Buffer.from(n);if(i.length<4)console.error("["+t.TAG+"]","Invalid message. Too short ("+i.length+")");else{var o=0,u=s.default.utf8ByteArrayToString(i.slice(o,4));switch(o+=4,u){case a.default.LIST:case a.default.STAT:case a.default.RECV:var l=i.readUInt32LE(o);o+=4;var d=i.slice(o,o+l),f=s.default.utf8ByteArrayToString(d);t.handle(u,e,f,r).catch((function(e){console.error("["+t.TAG+"]",e.message)}));break;case a.default.SEND:c.FilePushReader.handle(e,r);break;default:console.error("["+t.TAG+"]","Invalid message. Wrong command ("+u+")"),r.close(4001,"Invalid message. Wrong command ("+u+")")}}},t.handle=function(e,r,i,s){return n.__awaiter(this,void 0,void 0,(function(){return n.__generator(this,(function(n){try{if(e===a.default.STAT)return[2,o.AdbUtils.pipeStatToStream(r,i,s)];if(e===a.default.LIST)return[2,o.AdbUtils.pipeReadDirToStream(r,i,s)];if(e===a.default.RECV)return[2,o.AdbUtils.pipePullFileToStream(r,i,s)]}catch(e){t.sendError(e.message,s)}return[2]}))}))},t.sendError=function(e,t){if(t.readyState===t.OPEN){var r=Buffer.byteLength(e,"utf-8"),n=Buffer.alloc(8+r),i=n.write(a.default.FAIL,"ascii");i=n.writeUInt32LE(r,i),n.write(e,i,"utf-8"),t.send(n),t.close()}},t.TAG="FileListing",t}(i.Mw);t.FileListing=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePushReader=void 0;var n,i=r(0),o=r(69),s=r(71),a=r(72),u=r(8);!function(e){e[e.INITIAL=0]="INITIAL",e[e.NEW=1]="NEW",e[e.START=2]="START",e[e.APPEND=3]="APPEND",e[e.FINISH=4]="FINISH",e[e.CANCEL=5]="CANCEL"}(n||(n={}));var c=function(){function e(t,r){var a=this;this.serial=t,this.channel=r,this.fileName="",this.fileSize=0,this.pushId=-1,this.state=n.INITIAL,this.createStreamPromiseMap=new Map,this.disposed=!1,this.onMessage=function(t){return i.__awaiter(a,void 0,void 0,(function(){var r,a,u,c,l,d,f,h,p;return i.__generator(this,(function(i){switch(i.label){case 0:switch(r=o.CommandControlMessage.pushFileCommandFromBuffer(Buffer.from(t.data)),a=r.id,u=r.state,u){case o.FilePushState.NEW:return[3,1];case o.FilePushState.START:return[3,2];case o.FilePushState.APPEND:return[3,3];case o.FilePushState.FINISH:return[3,7];case o.FilePushState.CANCEL:return[3,10]}return[3,11];case 1:return this.state!==n.INITIAL?(this.closeWithError(s.FilePushResponseStatus.ERROR_INVALID_STATE),[2]):(this.state=n.NEW,this.pushId=e.getNextId(),this.sendResponse(s.FilePushResponseStatus.NEW_PUSH_ID),[3,12]);case 2:return this.verifyId(a)?this.state!==n.NEW?(this.closeWithError(s.FilePushResponseStatus.ERROR_INVALID_STATE),[2]):(c=r.fileName,l=r.fileSize,c?l?(this.fileName=c,this.fileSize=l,this.state=n.START,this.sendResponse(s.FilePushResponseStatus.NO_ERROR),[3,12]):(this.closeWithError(s.FilePushResponseStatus.ERROR_INCORRECT_SIZE),[2]):(this.closeWithError(s.FilePushResponseStatus.ERROR_INVALID_NAME),[2])):[2];case 3:return this.verifyId(a)?(d=r.chunk)&&d.length?this.state!==n.START?[3,5]:(f=this.createStream(d),this.createStreamPromiseMap.set(a,f),[4,f]):(this.closeWithError(s.FilePushResponseStatus.ERROR_INCORRECT_SIZE),[2]):[2];case 4:return i.sent(),this.createStreamPromiseMap.delete(a),this.state=n.APPEND,[2];case 5:if(this.state!==n.APPEND)return this.closeWithError(s.FilePushResponseStatus.ERROR_INVALID_STATE),[2];i.label=6;case 6:return null===(p=this.readStream)||void 0===p||p.push(d),[3,12];case 7:return this.verifyId(a)?(h=this.createStreamPromiseMap.get(a))?[4,h]:[3,9]:[2];case 8:i.sent(),i.label=9;case 9:return this.state!==n.APPEND?(this.closeWithError(s.FilePushResponseStatus.ERROR_INVALID_STATE),[2]):(this.state=n.FINISH,this.readStream&&(this.readStream.push(null),this.readStream.close(),this.readStream=void 0),[3,12]);case 10:return this.verifyId(a)?(this.state=n.CANCEL,this.readStream&&(this.readStream.push(null),this.readStream.close(),this.readStream=void 0),this.pushTransfer&&this.pushTransfer.cancel(),[3,12]):[2];case 11:if(!this.verifyId(a))return[2];this.closeWithError(s.FilePushResponseStatus.ERROR_INVALID_STATE),i.label=12;case 12:return[2]}}))}))},this.onClose=function(){a.release()},this.onPushError=function(e){a.closeWithError(s.FilePushResponseStatus.ERROR_OTHER,e.message)},this.onPushEnd=function(){a.state===n.FINISH?(a.sendResponse(s.FilePushResponseStatus.NO_ERROR),a.release()):a.closeWithError(s.FilePushResponseStatus.ERROR_INVALID_STATE)},this.onPushCancel=function(){a.state===n.CANCEL?(a.sendResponse(s.FilePushResponseStatus.NO_ERROR),a.release()):a.closeWithError(s.FilePushResponseStatus.ERROR_INVALID_STATE)},r.addEventListener("message",this.onMessage),r.addEventListener("close",this.onClose)}return e.handle=function(t,r){return new e(t,r)},e.getNextId=function(){return this.fileId++,this.fileId>this.maxId&&(this.fileId=1),this.fileId},e.createResponse=function(e,t){var r=Buffer.alloc(3),n=0;return n=r.writeInt16BE(e,n),r.writeInt8(t,n),r},e.prototype.verifyId=function(e){return e===this.pushId||(this.closeWithError(s.FilePushResponseStatus.ERROR_UNKNOWN_ID),!1)},e.prototype.sendResponse=function(t){this.channel.readyState!==this.channel.CLOSING&&this.channel.readyState!==this.channel.CLOSED&&this.channel.send(e.createResponse(this.pushId,t))},e.prototype.closeWithError=function(e,t){this.channel.removeEventListener("message",this.onMessage),this.channel.removeEventListener("close",this.onClose),this.channel.close(4e3-e,t),this.release()},e.prototype.createStream=function(e){return i.__awaiter(this,void 0,void 0,(function(){var t,r,n,o=this;return i.__generator(this,(function(i){switch(i.label){case 0:return t={construct:function(e){e(null)},read:function(){o.readStream&&(o.readStream.bytesRead>o.fileSize&&console.error("bytesRead ("+o.readStream.bytesRead+") > fileSize ("+o.fileSize+")"),o.sendResponse(s.FilePushResponseStatus.NO_ERROR))}},this.readStream=new a.ReadStream(this.fileName,t),this.readStream.push(e),r=u.AdbExtended.createClient(),n=this,[4,r.push(this.serial,this.readStream,this.fileName)];case 1:return n.pushTransfer=i.sent(),r.on("error",(function(e){console.error("Client error ("+o.serial+" | "+o.fileName+"):",e.message),o.closeWithError(s.FilePushResponseStatus.ERROR_OTHER,e.message)})),this.pushTransfer.on("error",this.onPushError),this.pushTransfer.on("end",this.onPushEnd),this.pushTransfer.on("cancel",this.onPushCancel),[2]}}))}))},e.prototype.release=function(){if(!this.disposed){this.disposed=!0,this.createStreamPromiseMap.clear(),this.readStream&&(this.readStream.close(),this.readStream=void 0),this.pushTransfer&&(this.pushTransfer.off("error",this.onPushError),this.pushTransfer.off("end",this.onPushEnd),this.pushTransfer.off("cancel",this.onPushCancel),this.pushTransfer=void 0),this.channel.removeEventListener("message",this.onMessage),this.channel.removeEventListener("close",this.onClose);var e=this.channel,t=e.readyState,r=e.CLOSED,n=e.CLOSING;t!==r&&t!==n&&this.channel.close()}},e.fileId=1,e.maxId=4294967295,e}();t.FilePushReader=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommandControlMessage=t.FilePushState=void 0;var n,i=r(0),o=r(70),s=i.__importDefault(r(3));!function(e){e[e.NEW=0]="NEW",e[e.START=1]="START",e[e.APPEND=2]="APPEND",e[e.FINISH=3]="FINISH",e[e.CANCEL=4]="CANCEL"}(n=t.FilePushState||(t.FilePushState={}));var a=function(e){function t(t){var r=e.call(this,t)||this;return r.type=t,r}return i.__extends(t,e),t.createSetVideoSettingsCommand=function(e){var r=e.toBuffer(),n=new t(o.ControlMessage.TYPE_CHANGE_STREAM_PARAMETERS),i=t.PAYLOAD_LENGTH+1,s=Buffer.alloc(i+r.length);return s.writeUInt8(n.type,0),r.forEach((function(e,t){s.writeUInt8(e,t+i)})),n.buffer=s,n},t.createSetClipboardCommand=function(e,r){void 0===r&&(r=!1);var n=new t(o.ControlMessage.TYPE_SET_CLIPBOARD),i=e?s.default.stringToUtf8ByteArray(e):null,a=i?i.length:0,u=0,c=Buffer.alloc(6+a);return u=c.writeInt8(n.type,u),u=c.writeInt8(r?1:0,u),u=c.writeInt32BE(a,u),i&&i.forEach((function(e,t){c.writeUInt8(e,t+u)})),n.buffer=c,n},t.createSetScreenPowerModeCommand=function(e){var r=new t(o.ControlMessage.TYPE_SET_SCREEN_POWER_MODE),n=0,i=Buffer.alloc(2);return n=i.writeInt8(r.type,n),i.writeUInt8(e?1:0,n),r.buffer=i,r},t.createPushFileCommand=function(e){var t=e.id,r=e.fileName,i=e.fileSize,o=e.chunk,s=e.state;if(s===n.START)return this.createPushFileStartCommand(t,r,i);if(s===n.APPEND){if(!o)throw TypeError("Invalid type");return this.createPushFileChunkCommand(t,o)}if(s===n.CANCEL||s===n.FINISH||s===n.NEW)return this.createPushFileOtherCommand(t,s);throw TypeError('Unsupported state: "'+s+'"')},t.createPushFileStartCommand=function(e,r,i){var a=new t(o.ControlMessage.TYPE_PUSH_FILE),u=s.default.stringToUtf8ByteArray(r),c=u.length,l=t.PAYLOAD_LENGTH,d=Buffer.alloc(l+1+2+1+4+2+c);return d.writeUInt8(a.type,l),l+=1,d.writeInt16BE(e,l),l+=2,d.writeInt8(n.START,l),l+=1,d.writeUInt32BE(i,l),l+=4,d.writeUInt16BE(c,l),l+=2,u.forEach((function(e,t){d.writeUInt8(e,t+l)})),a.buffer=d,a},t.createPushFileChunkCommand=function(e,r){var i=new t(o.ControlMessage.TYPE_PUSH_FILE),s=r.byteLength,a=t.PAYLOAD_LENGTH,u=Buffer.alloc(a+1+2+1+4+s);return u.writeUInt8(i.type,a),a+=1,u.writeInt16BE(e,a),a+=2,u.writeInt8(n.APPEND,a),a+=1,u.writeUInt32BE(s,a),a+=4,Array.from(r).forEach((function(e,t){u.writeUInt8(e,t+a)})),i.buffer=u,i},t.createPushFileOtherCommand=function(e,r){var n=new t(o.ControlMessage.TYPE_PUSH_FILE),i=t.PAYLOAD_LENGTH,s=Buffer.alloc(i+1+2+1);return s.writeUInt8(n.type,i),i+=1,s.writeInt16BE(e,i),i+=2,s.writeInt8(r,i),n.buffer=s,n},t.pushFileCommandFromBuffer=function(e){var r=0,i=e.readUInt8(r);if(r+=1,i!==t.TYPE_PUSH_FILE)throw TypeError('Incorrect type: "'+i+'"');var o=e.readInt16BE(r);r+=2;var a,u,c,l=e.readInt8(r);if(r+=1,l===n.APPEND){var d=e.readUInt32BE(r);r+=4,a=e.slice(r,r+d)}else if(l===n.START){u=e.readUInt32BE(r),r+=4;var f=e.readUInt16BE(r);r+=2,c=s.default.utf8ByteArrayToString(e.slice(r,r+f))}return{id:o,state:l,chunk:a,fileName:c,fileSize:u}},t.prototype.toBuffer=function(){if(!this.buffer){var e=Buffer.alloc(t.PAYLOAD_LENGTH+1);e.writeUInt8(this.type,0),this.buffer=e}return this.buffer},t.prototype.toString=function(){var e=this.buffer?", buffer=["+this.buffer.join(",")+"]":"";return"CommandControlMessage{action="+this.type+e+"}"},t.PAYLOAD_LENGTH=0,t.Commands=new Map([[o.ControlMessage.TYPE_EXPAND_NOTIFICATION_PANEL,"Expand notifications"],[o.ControlMessage.TYPE_EXPAND_SETTINGS_PANEL,"Expand settings"],[o.ControlMessage.TYPE_COLLAPSE_PANELS,"Collapse panels"],[o.ControlMessage.TYPE_GET_CLIPBOARD,"Get clipboard"],[o.ControlMessage.TYPE_SET_CLIPBOARD,"Set clipboard"],[o.ControlMessage.TYPE_ROTATE_DEVICE,"Rotate device"],[o.ControlMessage.TYPE_CHANGE_STREAM_PARAMETERS,"Change video settings"]]),t}(o.ControlMessage);t.CommandControlMessage=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlMessage=void 0;var n=function(){function e(e){this.type=e}return e.prototype.toBuffer=function(){throw Error("Not implemented")},e.prototype.toString=function(){return"ControlMessage"},e.prototype.toJSON=function(){return{type:this.type}},e.TYPE_KEYCODE=0,e.TYPE_TEXT=1,e.TYPE_TOUCH=2,e.TYPE_SCROLL=3,e.TYPE_BACK_OR_SCREEN_ON=4,e.TYPE_EXPAND_NOTIFICATION_PANEL=5,e.TYPE_EXPAND_SETTINGS_PANEL=6,e.TYPE_COLLAPSE_PANELS=7,e.TYPE_GET_CLIPBOARD=8,e.TYPE_SET_CLIPBOARD=9,e.TYPE_SET_SCREEN_POWER_MODE=10,e.TYPE_ROTATE_DEVICE=11,e.TYPE_CHANGE_STREAM_PARAMETERS=101,e.TYPE_PUSH_FILE=102,e}();t.ControlMessage=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilePushResponseStatus=void 0,function(e){e[e.NEW_PUSH_ID=1]="NEW_PUSH_ID",e[e.NO_ERROR=0]="NO_ERROR",e[e.ERROR_INVALID_NAME=-1]="ERROR_INVALID_NAME",e[e.ERROR_NO_SPACE=-2]="ERROR_NO_SPACE",e[e.ERROR_FAILED_TO_DELETE=-3]="ERROR_FAILED_TO_DELETE",e[e.ERROR_FAILED_TO_CREATE=-4]="ERROR_FAILED_TO_CREATE",e[e.ERROR_FILE_NOT_FOUND=-5]="ERROR_FILE_NOT_FOUND",e[e.ERROR_FAILED_TO_WRITE=-6]="ERROR_FAILED_TO_WRITE",e[e.ERROR_FILE_IS_BUSY=-7]="ERROR_FILE_IS_BUSY",e[e.ERROR_INVALID_STATE=-8]="ERROR_INVALID_STATE",e[e.ERROR_UNKNOWN_ID=-9]="ERROR_UNKNOWN_ID",e[e.ERROR_NO_FREE_ID=-10]="ERROR_NO_FREE_ID",e[e.ERROR_INCORRECT_SIZE=-11]="ERROR_INCORRECT_SIZE",e[e.ERROR_OTHER=-12]="ERROR_OTHER"}(t.FilePushResponseStatus||(t.FilePushResponseStatus={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReadStream=void 0;var n=r(0),i=function(e){function t(t,r){var n=e.call(this,r)||this;return n._path=t,n._bytesRead=0,n}return n.__extends(t,e),Object.defineProperty(t.prototype,"bytesRead",{get:function(){return this._bytesRead},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._path},enumerable:!1,configurable:!0}),t.prototype.push=function(t,r){return t&&(this._bytesRead+=t.length),e.prototype.push.call(this,t,r)},t.prototype.close=function(){this.destroy()},t}(r(73).Readable);t.ReadStream=i},function(e,t){e.exports=require("stream")}]);